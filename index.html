<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Copier</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #log { height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px; }
        .log-entry { margin-bottom: 5px; }
    </style>
</head>
<body>
    <h1>Website Copier</h1>
    <form id="copyForm">
        <label for="url">Website URL:</label>
        <input type="url" id="url" name="url" required>
        <button type="submit">Copy Website</button>
    </form>
    <h2>Log</h2>
    <div id="log"></div>

    <script>
        const form = document.getElementById('copyForm');
        const logDiv = document.getElementById('log');

        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            const url = document.getElementById('url').value;
            logDiv.innerHTML = ''; // Clear log
            await copyWebsite(url);
        });

        async function copyWebsite(url) {
            appendLog(`Starting to copy website: ${url}`);
            try {
                const response = await fetch(url);
                const html = await response.text();
                const baseUrl = new URL(url).origin;

                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                await processHtml(doc, baseUrl);

                const updatedHtml = new XMLSerializer().serializeToString(doc);
                downloadContent(updatedHtml, 'index.html');
                appendLog(`Website content successfully copied.`);
            } catch (error) {
                appendLog(`An error occurred: ${error.message}`);
            }
        }

        async function processHtml(doc, baseUrl) {
            await processLinks(doc, baseUrl, 'link', 'href', 'css', 'css');
            await processLinks(doc, baseUrl, 'script', 'src', 'js', 'js');
            await processLinks(doc, baseUrl, 'img', 'src', 'images', 'images');
            await processInlineStyles(doc, baseUrl, 'css');
        }

        async function processLinks(doc, baseUrl, tagName, attribute, dirName, folderName) {
            const elements = doc.getElementsByTagName(tagName);
            for (const element of elements) {
                const url = element.getAttribute(attribute);
                if (url) {
                    const fullUrl = new URL(url, baseUrl).href;
                    const filename = sanitizeFilename(fullUrl);
                    const filePath = `${dirName}/${filename}`;
                    await downloadFile(fullUrl, filePath);
                    element.setAttribute(attribute, `${folderName}/${filename}`);
                }
            }
        }

        async function processInlineStyles(doc, baseUrl, cssDir) {
            const elements = doc.querySelectorAll('[style]');
            for (const element of elements) {
                let style = element.getAttribute('style');
                style = await processCss(style, baseUrl, cssDir);
                element.setAttribute('style', style);
            }
        }

        async function processCss(cssContent, baseUrl, cssDir) {
            const urlPattern = /url\((.*?)\)/g;
            let match;
            while ((match = urlPattern.exec(cssContent)) !== null) {
                const resourceUrl = match[1].replace(/['"]/g, '');
                const fullUrl = new URL(resourceUrl, baseUrl).href;
                const filename = sanitizeFilename(fullUrl);
                const filePath = `${cssDir}/${filename}`;
                await downloadFile(fullUrl, filePath);
                cssContent = cssContent.replace(resourceUrl, `${cssDir}/${filename}`);
            }
            return cssContent;
        }

        function sanitizeFilename(url) {
            return url.replace(/[^\w\s]/g, '_').replace(/\s+/g, '_');
        }

        async function downloadFile(url, filename) {
            try {
                const response = await fetch(url);
                const blob = await response.blob();
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                link.click();
                appendLog(`Downloaded: ${filename}`);
            } catch (error) {
                appendLog(`Failed to download ${url}: ${error.message}`);
            }
        }

        function downloadContent(content, filename) {
            const blob = new Blob([content], { type: 'text/html' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        function appendLog(message) {
            const logEntry = document.createElement('div');
            logEntry.textContent = message;
            logEntry.classList.add('log-entry');
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
    </script>
</body>
</html>
